<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ziegen Spiel</title>
    <link rel="stylesheet" href="../css/navbar.css">
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: 'Comic Sans', cursive;
            color: #333;
            overflow: hidden;
            background: linear-gradient(to bottom, #272727, #808080); /* Grau zu helleres Grau Verlauf */
    background-color: #808080;
    background-size: 100% 100vh; /* Die Größe des Hintergrunds auf 100% der Breite und 100vh der Höhe setzen */
    background-repeat: no-repeat; /* Verhindert das Wiederholen des Hintergrunds */
        }

        .background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-size: 40px 40px;
        }

        canvas {
            border: 4px solid #000;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        #score, #highscore, #speedControl, #hornControl, #mustacheControl, #colorPickerControl {
            font-size: 24px;
            color: #313131;
            padding: 12px 24px;
            border-radius: 8px;
            margin-bottom: 16px;
            text-align: center;
        }

        #score { color: #ff0000; }
        #highscore { color: #6a00ff; }
        #speedControl { font-size: 22px; color: #ffeb3b; }
        #speedSlider { width: 180px; margin-top: 8px; }
        #hornControl p, #mustacheControl p {
            font-size: 18px;
            cursor: pointer;
            transition: color 0.3s;
        }
        #hornControl p.active, #mustacheControl p.active {
            color: #ffeb3b;
        }
        #colorPickerControl {
            display: flex;
            flex-direction: row;
            align-items: center;
        }
        #colorPickerControl input[type="color"] {
            margin-top: 8px;
            cursor: pointer;
        }
        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            color: #fff;
            background-color: rgba(0, 0, 0, 0.8);
            padding: 24px 48px;
            border-radius: 12px;
            display: none;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }
        #respawnButton {
            font-size: 24px;
            color: #fff;
            background-color: #e74c3c;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 16px;
            display: none;
            transition: background-color 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        #respawnButton:hover {
            background-color: #c0392b;
        }

        .cosmetics {
            display: flex;
            align-items: center;
            flex-direction: row;
        }
    </style>
</head>
<body>
    <header>
        <!-- <img class="logo" src="img/logo.svg" alt="logo"> -->
        <p class="logo">GOAT Services</p>
        <nav>
            <ul class="nav__links">
                <li><a href="index.html">Home</a></li>
                <li><a href="../socials.html">Socials</a></li>
                <li><a href="/games" class="current">Mini Games</a></li>
                <li><a href="../contact.html">Contact</a></li>
            </ul>
        </nav>
        <button onclick="window.location.href='/dashboard/login.php'" >
            Login / Sign Up
        </button>
        
    </header>
    <div class="background"></div>
    <div id="score">Punkte: 0</div>
    <div id="highscore">Highscore: 0</div>
    <div id="gameOver">Game Over</div>
    <button id="respawnButton">Neustart</button>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <div class="cosmetics">
        <div id="hornControl">
            <p id="hornToggle">Hörner: An</p>
        </div>
        <div id="mustacheControl">
            <p id="mustacheToggle">Bart: Aus</p>
        </div>
        <div id="colorPickerControl">
            <p>Farbe:</p>
            <input type="color" id="colorPicker" value="#00FF00">
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score');
        const highscoreDisplay = document.getElementById('highscore');
        const gameOverDisplay = document.getElementById('gameOver');
        const respawnButton = document.getElementById('respawnButton');
        const hornToggle = document.getElementById('hornToggle');
        const mustacheToggle = document.getElementById('mustacheToggle');
        const colorPicker = document.getElementById('colorPicker');
        const box = 40;
        let goat, food, score, direction, game, speed, highscore;
        let showHorns = true;
        let showMustache = false;
        let goatColor = '#00FF00'; // Standardfarbe der Ziege

        function getRandomColor() {
            return `rgb(${Math.floor(Math.random() * 256)}, ${Math.floor(Math.random() * 256)}, ${Math.floor(Math.random() * 256)})`;
        }

        function loadSettings() {
            // Laden der Einstellungen aus dem Local Storage
            const storedHorns = localStorage.getItem('showHorns');
            const storedMustache = localStorage.getItem('showMustache');
            const storedColor = localStorage.getItem('goatColor');

            if (storedHorns !== null) {
                showHorns = JSON.parse(storedHorns);
            }
            if (storedMustache !== null) {
                showMustache = JSON.parse(storedMustache);
            }
            if (storedColor !== null) {
                goatColor = storedColor;
            }

            hornToggle.textContent = `Hörner: ${showHorns ? 'An' : 'Aus'}`;
            mustacheToggle.textContent = `Bart: ${showMustache ? 'An' : 'Aus'}`;
            colorPicker.value = goatColor;
        }

        function saveSettings() {
            // Speichern der aktuellen Einstellungen im Local Storage
            localStorage.setItem('showHorns', JSON.stringify(showHorns));
            localStorage.setItem('showMustache', JSON.stringify(showMustache));
            localStorage.setItem('goatColor', goatColor);
        }

        function loadHighscore() {
            highscore = parseInt(localStorage.getItem('highscore')) || 0;
            highscoreDisplay.textContent = `Highscore: ${highscore}`;
        }

        function saveHighscore() {
            if (score > highscore) {
                highscore = score;
                localStorage.setItem('highscore', highscore);
                highscoreDisplay.textContent = `Highscore: ${highscore}`;
            }
        }

        function init() {
            goat = [{ x: 4 * box, y: 5 * box }];
            food = { x: Math.floor(Math.random() * 10) * box, y: Math.floor(Math.random() * 10) * box };
            score = 0;
            direction = null;
            speed = 150; // Startgeschwindigkeit
            scoreDisplay.textContent = `Punkte: ${score}`;
            gameOverDisplay.style.display = 'none';
            respawnButton.style.display = 'none';
            loadHighscore();
            loadSettings(); // Lade die gespeicherten Einstellungen
            if (game) {
                clearInterval(game);
            }
            game = setInterval(draw, speed);
        }

        function setDirection(event) {
            const { keyCode } = event;
            if ((keyCode === 37 || keyCode === 65) && direction !== 'RIGHT') {
                direction = 'LEFT';
            } else if ((keyCode === 38 || keyCode === 87) && direction !== 'DOWN') {
                direction = 'UP';
            } else if ((keyCode === 39 || keyCode === 68) && direction !== 'LEFT') {
                direction = 'RIGHT';
            } else if ((keyCode === 40 || keyCode === 83) && direction !== 'UP') {
                direction = 'DOWN';
            }
        }

        function collision(head, array) {
            return array.some(segment => head.x === segment.x && head.y === segment.y);
        }

        function drawGoat() {
            goat.forEach((segment, index) => {
                ctx.fillStyle = index === 0 ? goatColor : getRandomColor();
                ctx.strokeStyle = 'black';
                ctx.fillRect(segment.x, segment.y, box, box);
                ctx.strokeRect(segment.x, segment.y, box, box);

                if (index === 0) {
                    // Berechnung der Pupillenposition
                    let pupilXOffset = 0;
                    let pupilYOffset = 0;
                    if (direction === 'LEFT') {
                        pupilXOffset = -box / 8;
                    } else if (direction === 'RIGHT') {
                        pupilXOffset = box / 8;
                    } else if (direction === 'UP') {
                        pupilYOffset = -box / 8;
                    } else if (direction === 'DOWN') {
                        pupilYOffset = box / 8;
                    }

                    // Zeichne Augen
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    ctx.arc(segment.x + box / 4 + box / 8, segment.y + box / 4 + box / 8, box / 8, 0, Math.PI * 2);
                    ctx.fill();

                    ctx.fillStyle = 'black';
                    ctx.beginPath();
                    ctx.arc(segment.x + box / 4 + box / 8 + pupilXOffset, segment.y + box / 4 + box / 8 + pupilYOffset, box / 16, 0, Math.PI * 2);
                    ctx.fill();

                    // Auge 2
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    ctx.arc(segment.x + 3 * box / 4 + box / 8, segment.y + box / 4 + box / 8, box / 8, 0, Math.PI * 2);
                    ctx.fill();

                    ctx.fillStyle = 'black';
                    ctx.beginPath();
                    ctx.arc(segment.x + 3 * box / 4 + box / 8 + pupilXOffset, segment.y + box / 4 + box / 8 + pupilYOffset, box / 16, 0, Math.PI * 2);
                    ctx.fill();

                    if (showHorns) {
                        ctx.strokeStyle = 'saddlebrown';
                        ctx.lineWidth = 4;
                        ctx.beginPath();
                        ctx.moveTo(segment.x + box / 4, segment.y);
                        ctx.lineTo(segment.x + box / 8, segment.y - box / 2);
                        ctx.stroke();

                        ctx.beginPath();
                        ctx.moveTo(segment.x + 3 * box / 4, segment.y);
                        ctx.lineTo(segment.x + 7 * box / 8, segment.y - box / 2);
                        ctx.stroke();
                    }

                    if (showMustache) {
                        ctx.strokeStyle = 'black';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.arc(segment.x + box / 2, segment.y + 3 * box / 4, box / 2, 0, Math.PI, true);
                        ctx.stroke();

                        ctx.beginPath();
                        ctx.arc(segment.x + box / 3, segment.y + 5 * box / 6, box / 4, 0, Math.PI, false);
                        ctx.stroke();

                        ctx.beginPath();
                        ctx.arc(segment.x + 2 * box / 3, segment.y + 5 * box / 6, box / 4, 0, Math.PI, false);
                        ctx.stroke();
                    }
                }
            });
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawGoat();

            ctx.fillStyle = 'red';
            ctx.fillRect(food.x, food.y, box, box);

            let goatX = goat[0].x;
            let goatY = goat[0].y;

            if (direction === 'LEFT') goatX -= box;
            if (direction === 'UP') goatY -= box;
            if (direction === 'RIGHT') goatX += box;
            if (direction === 'DOWN') goatY += box;

            if (goatX === food.x && goatY === food.y) {
                score++;
                scoreDisplay.textContent = `Punkte: ${score}`;
                food = {
                    x: Math.floor(Math.random() * 10) * box,
                    y: Math.floor(Math.random() * 10) * box
                };
                speed = Math.max(50, speed * 0.95);
                clearInterval(game);
                game = setInterval(draw, speed);
            } else {
                goat.pop();
            }

            const newHead = { x: goatX, y: goatY };

            if (goatX < 0 || goatY < 0 || goatX >= canvas.width || goatY >= canvas.height || collision(newHead, goat)) {
                clearInterval(game);
                saveHighscore();
                gameOverDisplay.style.display = 'block';
                respawnButton.style.display = 'block';
            }

            goat.unshift(newHead);
        }

        document.addEventListener('keydown', setDirection);
        respawnButton.addEventListener('click', init);
        hornToggle.addEventListener('click', () => {
            showHorns = !showHorns;
            hornToggle.textContent = `Hörner: ${showHorns ? 'An' : 'Aus'}`;
            saveSettings();
        });
        mustacheToggle.addEventListener('click', () => {
            showMustache = !showMustache;
            mustacheToggle.textContent = `Bart: ${showMustache ? 'An' : 'Aus'}`;
            saveSettings();
        });
        colorPicker.addEventListener('input', (event) => {
            goatColor = event.target.value;
            saveSettings();
        });

        init();
    </script>
</body>
</html>
